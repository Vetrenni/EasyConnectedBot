{% extends 'base.html' %}

{% block title %}Чат {{ chat.id }} - Админ-панель{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Чат {{ chat.id }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{{ url_for('chats') }}" class="btn btn-sm btn-outline-secondary">Назад к списку</a>
            {% if chat.status == 'open' %}
            <form action="{{ url_for('close_chat', chat_id=chat.id) }}" method="post" onsubmit="return confirm('Закрыть этот чат?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">Закрыть чат</button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5>Информация о чате</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>ID пользователя:</strong> {{ chat.user_id }}</p>
                <p><strong>Статус:</strong>
                    {% if chat.status == 'open' %}
                    <span class="badge bg-success">Открыт</span>
                    {% else %}
                    <span class="badge bg-secondary">Закрыт</span>
                    {% endif %}
                </p>
                <p><strong>Создан:</strong> {{ chat.created_at }}</p>
                {% if chat.closed_at %}
                <p><strong>Закрыт:</strong> {{ chat.closed_at }}</p>
                {% endif %}
            </div>
            <div class="col-md-6">
                <p><strong>Метод выплаты:</strong> {{ chat.user_settings.payout_method if chat.user_settings.payout_method else 'Не указано' }}</p>
                <p><strong>Реквизиты:</strong> {{ chat.user_settings.requisites if chat.user_settings.requisites else 'Не указано' }}</p>
                <p><strong>Страна:</strong> {{ chat.user_settings.country if chat.user_settings.country else 'Не указано' }}</p>
                <p><strong>Банк:</strong> {{ chat.user_settings.bank if chat.user_settings.bank else 'Не указано' }}</p>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5>Сообщения</h5>
    </div>
    <div class="card-body">
        <div class="chat-messages">
            {% for message in chat.messages %}
            <div class="card mb-3 {% if message.sender_type == 'Стриммер' %}border-primary{% else %}border-success{% endif %}">
                <div class="card-header">
                    <strong>{{ message.sender_type }}</strong> ({{ message.sender_id }})
                    <small class="text-muted float-end">{{ message.timestamp }}</small>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ message.text }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}